const _0x473677=_0x1088;(function(_0x41615d,_0x1bbe87){const _0x2e4ba7=_0x1088,_0x4d3d64=_0x41615d();while(!![]){try{const _0x10aad3=parseInt(_0x2e4ba7(0xab))/0x1*(parseInt(_0x2e4ba7(0xb4))/0x2)+-parseInt(_0x2e4ba7(0xb3))/0x3*(-parseInt(_0x2e4ba7(0xc1))/0x4)+-parseInt(_0x2e4ba7(0xc5))/0x5+parseInt(_0x2e4ba7(0xc3))/0x6+-parseInt(_0x2e4ba7(0xaa))/0x7+-parseInt(_0x2e4ba7(0xc0))/0x8+-parseInt(_0x2e4ba7(0xa9))/0x9*(-parseInt(_0x2e4ba7(0xbe))/0xa);if(_0x10aad3===_0x1bbe87)break;else _0x4d3d64['push'](_0x4d3d64['shift']());}catch(_0x3b27a1){_0x4d3d64['push'](_0x4d3d64['shift']());}}}(_0x573e,0x68c21));import{ElementType}from 'src/core/src/entities';import _0x32fc46 from'path';function _0x1088(_0x128a7f, _0x1a7feb){const _0x573e5a=_0x573e();return _0x1088=function(_0x1088c2, _0x2088da){_0x1088c2=_0x1088c2-0xa6;let _0x43b4af=_0x573e5a[_0x1088c2];return _0x43b4af;},_0x1088(_0x128a7f,_0x1a7feb);}import _0x467baa from'fs';import{napCatCore}from'@/core';import{calculateFileMD5}from'@/common/utils/file';import*as _0x2747ca from'file-type';function _0x573e(){const _0x202a95=['3391825SjQoUR','msg','getFileSize','wrapper','getImageSize','baknI','addMsgListener','wEjLP','ext','86571iDJwkq','3669981WQcnMh','28869oPFnJn','downloadRichMedia','GLhIc','TWJeJ','util','existsSync','PIC','removeKernelMsgListener','589839MBTmGE','8INjGBu','kernelService','getFileType','下载超时','join','basename','service','copyFile','defaultFileDownloadPath','msgId','1600bFKCUA','HqeKG','2786912hcXjia','4aKftyy','getRichMediaFilePathForGuild','773832Tcorxz','IeZdI'];_0x573e=function(){return _0x202a95;};return _0x573e();}import{MsgListener}from 'src/core/src/listeners';import _0x42c77e from'image-size';import{sessionConfig}from '@/core/sessionConfig.js';export class NTQQFileApi{static async[_0x473677(0xb6)](_0x30d542){return _0x2747ca['fileTypeFromFile'](_0x30d542);}static async[_0x473677(0xbb)](_0x2059fe, _0x42ec14){const _0x48dd83=_0x473677;await napCatCore[_0x48dd83(0xc8)][_0x48dd83(0xaf)][_0x48dd83(0xbb)](_0x2059fe,_0x42ec14);}static async[_0x473677(0xc7)](_0x1ad250){const _0x94dd46=_0x473677;return await napCatCore[_0x94dd46(0xc8)][_0x94dd46(0xaf)]['getFileSize'](_0x1ad250);}static async['uploadFile'](_0x175484, _0x5cdc69=ElementType[_0x473677(0xb1)], _0x4e17c9=0x0){const _0x1f3080=_0x473677,_0x284e8a={'IeZdI':function(_0xd6c5e6, _0xd812ae){return _0xd6c5e6(_0xd812ae);},'GLhIc':function(_0x5be464, _0x4ece6c){return _0x5be464+_0x4ece6c;},'baknI':function(_0x2383be, _0x7247e){return _0x2383be===_0x7247e;}},_0x1bb716=await _0x284e8a[_0x1f3080(0xc4)](calculateFileMD5,_0x175484);let _0x2467b9=(await NTQQFileApi['getFileType'](_0x175484))?.[_0x1f3080(0xa8)]||'';_0x2467b9&&(_0x2467b9=_0x284e8a[_0x1f3080(0xad)]('.',_0x2467b9));let _0x1c469b=''+_0x32fc46[_0x1f3080(0xb9)](_0x175484);_0x284e8a[_0x1f3080(0xca)](_0x1c469b['indexOf']('.'),-0x1)&&(_0x1c469b+=_0x2467b9);const _0xe45bab=napCatCore[_0x1f3080(0xba)][_0x1f3080(0xc6)][_0x1f3080(0xb5)][_0x1f3080(0xc2)]({'md5HexStr':_0x1bb716,'fileName':_0x1c469b,'elementType':_0x5cdc69,'elementSubType':_0x4e17c9,'thumbSize':0x0,'needCreate':!![],'downloadType':0x1,'file_uuid':''});await NTQQFileApi[_0x1f3080(0xbb)](_0x175484,_0xe45bab);const _0x2bddd9=await NTQQFileApi[_0x1f3080(0xc7)](_0x175484);return{'md5':_0x1bb716,'fileName':_0x1c469b,'path':_0xe45bab,'fileSize':_0x2bddd9,'ext':_0x2467b9};}static async['downloadMedia'](_0x3203b5, _0x39bc5d, _0x526fb1, _0x27c879, _0x316e27, _0x2ac718, _0x29d8fc=0x3e8*0x3c*0x2){const _0x5d1d33=_0x473677,_0x34ab3b={'HqeKG':_0x5d1d33(0xb7),'wEjLP':function(_0x4adf72, _0x9409fe, _0x551656){return _0x4adf72(_0x9409fe,_0x551656);}};if(_0x2ac718&&_0x467baa[_0x5d1d33(0xb0)](_0x2ac718))return _0x2ac718;const _0xf309e6=new MsgListener();return new Promise((_0x3da7d7, _0x54af01)=>{const _0x565c7e=_0x5d1d33,_0x1cf9af={'TWJeJ':function(_0x5b3b5c, _0x1ec074){return _0x5b3b5c(_0x1ec074);}};let _0x458f7e=![];_0xf309e6['onRichMediaDownloadComplete']= _0xd0be89=>{const _0x467511=_0x1088;if(_0xd0be89[_0x467511(0xbd)]===_0x3203b5){_0x458f7e=!![];let _0x3554d6=_0xd0be89['filePath'];if(_0x3554d6['startsWith']('\x5c')){const _0x42f2a2=sessionConfig?.[_0x467511(0xbc)];_0x3554d6=_0x32fc46[_0x467511(0xb8)](_0x42f2a2,_0x3554d6);}_0x1cf9af[_0x467511(0xae)](_0x3da7d7,_0x3554d6),napCatCore[_0x467511(0xba)]['msg'][_0x467511(0xb5)]?.[_0x467511(0xb2)](_0x65ecb1);}};const _0x65ecb1=napCatCore[_0x565c7e(0xba)][_0x565c7e(0xc6)][_0x565c7e(0xa6)](_0xf309e6);_0x34ab3b[_0x565c7e(0xa7)](setTimeout,()=>{const _0x56a042=_0x565c7e;!_0x458f7e&&(_0x54af01(new Error(_0x34ab3b[_0x56a042(0xbf)])),napCatCore['service'][_0x56a042(0xc6)]['kernelService']?.[_0x56a042(0xb2)](_0x65ecb1));},_0x29d8fc),napCatCore[_0x565c7e(0xba)][_0x565c7e(0xc6)][_0x565c7e(0xb5)]?.[_0x565c7e(0xac)]({'fileModelId':'0','downloadSourceType':0x0,'triggerType':0x1,'msgId':_0x3203b5,'chatType':_0x39bc5d,'peerUid':_0x526fb1,'elementId':_0x27c879,'thumbSize':0x0,'downloadType':0x1,'filePath':_0x316e27});});}static async[_0x473677(0xc9)](_0x2da229){return new Promise((_0x553e16, _0x1e0e7e)=>{_0x42c77e(_0x2da229,(_0x103d6, _0x1f3b3a)=>{_0x103d6?_0x1e0e7e(_0x103d6):_0x553e16(_0x1f3b3a);});});}}
